import { getTransactionStatus } from "@mandujs/core";
import { getRootDir } from "../../util/fs";

export async function changeStatus(): Promise<boolean> {
  const rootDir = getRootDir();

  console.log(`ğŸ¥Ÿ Mandu Change Status\n`);

  try {
    const { state, change } = await getTransactionStatus(rootDir);

    if (state.active && change) {
      console.log(`ğŸ”„ í™œì„± íŠ¸ëœì­ì…˜:`);
      console.log(`   ID: ${change.id}`);
      console.log(`   ìŠ¤ëƒ…ìƒ·: ${change.snapshotId}`);
      console.log(`   ì‹œì‘: ${new Date(change.createdAt).toLocaleString()}`);
      if (change.message) {
        console.log(`   ë©”ì‹œì§€: ${change.message}`);
      }
      if (change.autoGenerated) {
        console.log(`   ìƒì„±: Auto-correct`);
      }
      console.log(`\nğŸ’¡ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹:`);
      console.log(`   í™•ì •: bunx mandu change commit`);
      console.log(`   ë¡¤ë°±: bunx mandu change rollback`);
    } else {
      console.log(`âœ… í™œì„± íŠ¸ëœì­ì…˜ ì—†ìŒ`);
      console.log(`\nğŸ’¡ ìƒˆ íŠ¸ëœì­ì…˜ ì‹œì‘: bunx mandu change begin`);
    }

    return true;
  } catch (error) {
    console.error(`âŒ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ${error instanceof Error ? error.message : String(error)}`);
    return false;
  }
}
